<!DOCTYPE html>
<html>
  <head>
  <link href="http://sighingnow.github.io" rel="profile">
  <meta charset="UTF-8">
  
  <meta name="description" content="Sighingnow's homepage using Jekyll Metro">
  
	<meta name="author" content="Sighingnow">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Java 多线程 &middot; Sighingnow
    
  </title>

  
  <!-- Twitter Card data -->
  <meta name="twitter:card" value="summary">
  <!-- Open Graph data -->
  <meta property="og:title" content="Java 多线程" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/java_thread.html" />
  <meta property="og:description" content="" />
  

  <!-- CSS -->
  <link rel="stylesheet" href="http://sighingnow.github.io/assets/css/bootstrap.css">
  <link rel="stylesheet" href="http://sighingnow.github.io/assets/css/app.css">
  <link rel="stylesheet" href="http://sighingnow.github.io/assets/css/pandoc-tango.css">

  <script src="/assets/js/all.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/jekyll-search.js"></script>


  

  

  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>


  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="128x128" href="http://sighingnow.github.io/assets/images/favicon-128.png">
  <link rel="shortcut icon" href="http://sighingnow.github.io/assets/images/favicon-16.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
</head>

  <body>
                  <div class="navbar navbar-default visible-xs">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">Sighingnow</a>
                </div>
                <div class="navbar-collapse collapse navbar-responsive-collapse">
                    <ul class="nav navbar-nav">
                        
                          <li>
                            <a href="/about/">About</a>
                          </li>
                        
                          <li>
                            <a href="/resume/">Resume</a>
                          </li>
                        
                          <li>
                            <a href="/blog/">Blog</a>
                          </li>
                        
                          <li>
                            <a href="/archive/">Archive</a>
                          </li>
                        
                          <li>
                            <a href="/tags/">Tags</a>
                          </li>
                        
                    </ul>
                </div>
            </div>

      <div class="container-fluid">
  <div class="row">
    <div class="hidden-xs col-md-2 col-sm-3 blue sidebar">
      <aside>
  <div class="row">
    <div class="col-md-12">
    <br/>
        
        <h1 class="text-center" style="margin-top:0px"><a href="/blog" class="icon icon-back"></a></h1>
        
    </div>
  </div>
  <div class="row">
      <div class="col-md-12">
        <ul class="left-nav">
        
          
          
            <li class="left-nav-item">
              <a href="/about/">About</a>
            </li>
          
        
          
          
            <li class="left-nav-item">
              <a href="/resume/">Resume</a>
            </li>
          
        
          
          
            <li class="left-nav-item left-nav-selected">Blog</a>
          
        
          
          
            <li class="left-nav-item">
              <a href="/archive/">Archive</a>
            </li>
          
        
          
          
            <li class="left-nav-item">
              <a href="/tags/">Tags</a>
            </li>
          
        
        </ul>
    </div>
  </div>
</aside>

    </div> <!-- Side column -->
    <div class="col-md-10 col-sm-9 col-md-offset-2 col-sm-offset-3">
      <article class="col-md-12 col-xs-12 justified">
        <h1 class="post-title">Java 多线程</h1>
        <div class="publish-tag">
          <span class="fa fa-calendar"></span>&nbsp;Published On April 29, 2015
        </div>
        <p>随着多核芯片逐渐成为主流，大多数软件开发人员不可避免地需要了解并行编程的知识。而同时，主流程序语言正在将越来越多的并行特性合并到标准库或者语言本身之中。我们可以看到，JDK 在这方面同样走在潮流的前方。从JDK 5到JDK 7，越来越多的线程相关的新API加入到了标准库中，为不同场景下对线程实现与调度提供了完善的支持。我们可以充分利用这些类库，来提高开发效率，改善程序性能。</p>
<h2 id="java中使用线程">Java中使用线程</h2>
<p>Java的多线程基于以下两个重要的机制：</p>
<ol type="1">
<li>父线程结束，如果子线程正在运行，子线程不会跟着结束。</li>
<li>每个线程拥有一个线程栈，会维护引用，用于GC。</li>
</ol>
<!--more-->
<p>Java提供了以下两种常用的方式来使用多线程：</p>
<ol type="1">
<li>继承<code>Thread</code>类</li>
<li>实现<code>Runnable</code>接口</li>
</ol>
<h3 id="继承thread类">继承<code>Thread</code>类</h3>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> MyThread <span class="kw">extends</span> Thread {
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
    
    } 
}

Thread t = <span class="kw">new</span> <span class="fu">MyThread</span>();
t.<span class="fu">start</span>();</code></pre>
<h3 id="实现runnable接口">实现<code>Runnable</code>接口</h3>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> MyThread <span class="kw">implements</span> Runnable {
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
    
    }
}

MyThread mt = <span class="kw">new</span> <span class="fu">MyThread</span>();
Thread t = <span class="kw">new</span> Thread(mt);
t.<span class="fu">start</span>();</code></pre>
<p>需要注意的是：<strong>一个线程只能start()一次</strong>，如果多次调用<code>start()</code>方法，会出现<code>Java.lang.IllegalStateException</code>。</p>
<p>两种方式的区别在于继承<code>Thread</code>方式是每次都会创建一个<code>MyThread</code>对象，而如果采用实现<code>Runnable</code>接口的方式，可以使用同一个<code>MyThread</code>对象来创建多个线程，便于线程间共享内存。因此，设计线程间的数据共享时，一般应当采用实现<code>Runnable</code>接口的方式。</p>
<h2 id="callable与future">Callable与Future</h2>
<p><code>java.util.concurrent</code>包中还提供了一个<code>Callable</code>接口来实现线程，使用<code>Callable</code>需要与<code>Future</code>类配合使用。</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> TEMP {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) <span class="kw">throws</span> Exception {
         FutureTask&lt;Integer&gt; task = <span class="kw">new</span> FutureTask&lt;&gt;(<span class="kw">new</span> <span class="fu">FF</span>());
         <span class="kw">new</span> Thread(task).<span class="fu">start</span>();
         System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;main thread&quot;</span>);
         System.<span class="fu">out</span>.<span class="fu">println</span>(task.<span class="fu">get</span>());
    }
}

<span class="kw">class</span> FF <span class="kw">implements</span> Callable&lt;Integer&gt; {
    <span class="fu">@Override</span>
    <span class="kw">public</span> Integer <span class="fu">call</span>() <span class="kw">throws</span> Exception {
        Thread.<span class="fu">sleep</span>(<span class="dv">2000</span>);
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;ff thread&quot;</span>);
        <span class="kw">return</span> <span class="kw">new</span> Random().<span class="fu">nextInt</span>(<span class="dv">100</span>);
    }
}</code></pre>
<p>程序运行的输出为：</p>
<pre><code>main thread
ff thread
34</code></pre>
<p><code>Callable</code>接口与<code>Runnable</code>接口类似，不同的是，<code>call</code>方法是可以有返回值的，并且可以抛出异常。如果没有<code>System.out.println(task.get())</code>，那么主线程在运行完<code>System.out.println(&quot;main thread&quot;)</code>就会结束，但是因为有<code>task.get()</code>，因此，主线程会等待<code>Callable</code>线程执行完毕。</p>
<p>与<code>Callable-Future</code>类似的一个方法是回调(callback)。在子线程结束时调用父线程的方法来通知父线程。</p>
<p>一般Callable/Future与ExecutorService配合使用。使用<code>ExecutorService</code>来运行<code>Callable</code>线程：</p>
<pre class="sourceCode java"><code class="sourceCode java">ExecutorService exec = Executors.<span class="fu">newCachedThreadPool</span>();
<span class="co">// exec = Executors.newFixedThreadPool(3 /* nThread */);</span>
exec.<span class="fu">submit</span>(<span class="kw">new</span> Callable&lt;Integer&gt;() {
    <span class="fu">@Override</span>
    <span class="kw">public</span> Integer <span class="fu">call</span>() <span class="kw">throws</span> Exception {
        <span class="co">// ...</span>
        <span class="kw">return</span> <span class="kw">null</span>;
    }
});
<span class="co">// exec.shutdown();</span></code></pre>
<p>ExecutorService也可以用来执行实现Runnable线程：</p>
<pre class="sourceCode java"><code class="sourceCode java">exec.<span class="fu">submit</span>(<span class="kw">new</span> Runnable() {
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() <span class="kw">throws</span> Exception {
        <span class="co">// ...</span>
    }
});</code></pre>
<p>使用<code>ExecutorService</code>时，可以通过<code>FutureTask</code>来获取Callable线程call方法的返回值：</p>
<pre class="sourceCode java"><code class="sourceCode java">ExecutorService exec = Executors.<span class="fu">newCachedThreadPool</span>();
FutureTask&lt;Integer&gt; task = <span class="kw">new</span> FutureTask&lt;&gt;(<span class="kw">new</span> Callable&lt;Integer&gt;() {
    <span class="fu">@Override</span>
    <span class="kw">public</span> Integer <span class="fu">call</span>() <span class="kw">throws</span> Exception {
        <span class="co">// ...</span>
        <span class="kw">return</span> <span class="kw">null</span>;
    }
});
exec.<span class="fu">submit</span>(task);
Integer result = task.<span class="fu">get</span>();</code></pre>
<p>ExecutorService还可以取消(cancel)一个Task(FutureTask)。</p>
<h2 id="简单的线程同步">简单的线程同步</h2>
<p>Java提供了强制原子性的内置锁机制：synchronized块。一个synchronized块有两部分：所对象的引用以及这个锁保护的代码块。内置锁在Java中扮演了互斥锁(mutex)的角色。<strong>内置锁匙可重入的(Reentrant)</strong>。通常使用<code>synchronized</code>关键字来进行线程间的同步。<code>synchronized</code>有两种用法：修饰方法和修饰代码块。</p>
<h3 id="修饰方法">修饰方法</h3>
<p>可以使用<code>synchronized</code>关键字来修饰类中的方法，从而达到线程间同步的目的。示例：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> A {
    <span class="kw">public</span> <span class="kw">synchronized</span> <span class="dt">void</span> <span class="fu">Func</span>() {
        <span class="co">// ...</span>
    }
}</code></pre>
<p><code>synchronized</code>关键字修饰方法表明该方法在运行期间将会对<code>this</code>加锁，也就是说，当方法<code>Func</code>运行时其他方法无法操作<code>this</code>对象。需要注意的是，<code>synchronized</code>与<code>static</code>关键字是可以共存的。</p>
<h3 id="修饰代码块">修饰代码块</h3>
<p><code>synchronized</code>关键字除了用来修饰方法，还可以用来修饰代码块：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> A {
    Integer i;
    <span class="co">// ...</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">func</span>() {
        <span class="co">// ...</span>
        <span class="kw">synchronized</span>(i) {
            <span class="co">// ...</span>
        }
    }
}</code></pre>
<p>这表明在<code>synchronized</code>中的代码块运行期间将会占有锁<code>this.i</code>。<code>synchronized</code>修饰方法等价于下列写法：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> A {
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Func</span>() {
        <span class="kw">synchronized</span>(<span class="kw">this</span>) {
            <span class="co">// ...</span>
        }
    }
}</code></pre>
<p>可以看到，<code>synchronized</code>修饰代码块与修饰方法类似，但控制粒度更细，同步开销也较小。但是，在尽量减小同步代码块规模时应该注意原子操作中的语句必须在同一个同步代码块中。</p>
<h3 id="静态方法同步">静态方法同步</h3>
<p>要同步静态方法，需要一个作用于整个类对象的锁。这个锁就是类自身。举例：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> A {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">func</span>() {
        <span class="kw">synchronized</span>(B.<span class="fu">class</span>) {
            <span class="co">// ...</span>
        }
    }
}</code></pre>
<h3 id="可重入锁">可重入锁</h3>
<p>另一个需要注意的地方是Java的同步锁匙可重入锁，例如，递归调用<code>run</code>方法或者调用的函数有同样的<code>synchronized</code>锁并不会造成死锁。示例如下：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> KK <span class="kw">extends</span> Thread {
    <span class="dt">static</span> Integer x = <span class="dv">10</span>;
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
        <span class="kw">synchronized</span> (x) {
            <span class="kw">if</span>(x &gt; <span class="dv">5</span>) {
                x -= <span class="dv">1</span>;
                System.<span class="fu">out</span>.<span class="fu">println</span>(x);
                <span class="fu">run</span>();
            }
        }
    }
}</code></pre>
<p><code>wait</code>, <code>notify</code>, <code>notifyAll</code>，<code>join</code>是常用的线程控制调度方法。</p>
<h2 id="共享对象可见性和volatile">共享对象可见性和<code>volatile</code></h2>
<p>一种常见的错误观念认为只有写入共享变量是才需要同步，其实并非如此。<code>volatile</code>是一个声明，<code>volatile</code>关键字表示内存可见，<code>volatile</code>声明的变量不会被copy到线程的本地内存(<strong>缓存、缓冲区、寄存器，Cache等</strong>)中，而是直接在主存上进行操作。每次使用前从主存中读取新值，修改后立即写入主存，这用于防止线程间因寄存器和缓存引起的肮脏数据的读取和使用。</p>
<p>进一步的，JVM的规范里并没有要求<code>volatile</code>关键字修饰的变量一定不能被copy到线程的本地内存中，而是要求对其读写需要遵循<code>happens-before</code>语义，类似于互斥锁。同时，<code>volatile</code><strong>还涉及到编译器的指令重排和CPU的重排序等等</strong>（影响变量之间的访问顺序）。</p>
<p>有些时候，可能一个线程只需要<strong>读</strong>一个变量的值，这时也有可能需要使用<code>volatile</code>的方式来防止出现同步错误。但需要注意的是，<code>volatile</code>不能和<code>final</code>一起共同修饰一个变量，因为<code>final</code>变量是不可改的。</p>
<h2 id="lockcondition机制">Lock/Condition机制</h2>
<p>Lock是控制多个线程对共享资源进行访问的工具。通常，锁提供了对共享资源的独占访问，每次只能有一个线程对Lock对象加锁，线程开始访问共享资源之前应先获得Lock对象。不过某些锁支持共享资源的并发访问，如：ReadWriteLock（读写锁），在线程安全控制中，通常使用ReentrantLock（可重入锁）。使用该Lock对象可以显示加锁、释放锁。</p>
<p>使用Lock的一般框架：</p>
<pre class="sourceCode java"><code class="sourceCode java">Lock lock = <span class="kw">new</span> <span class="fu">ReetrantLock</span>();
lock.<span class="fu">lock</span>();
<span class="kw">try</span> {
    <span class="co">// ...</span>
}
<span class="kw">finally</span> {
    lock.<span class="fu">unlock</span>();
}</code></pre>
<p>注意，<code>try</code>中的语句块是可能抛出异常的，因此，如果可能有异常抛出，那么<code>lock.unlock()</code>必须在<code>finally</code>语句块中，以确保JVM会释放锁。通常认为：Lock提供了比synchronized方法和synchronized代码块更广泛的锁定操作，Lock更灵活的结构，有很大的差别，并且可以支持多个Condition对象。</p>
<p>Condition的功能更类似于传统多线程技术中的<code>Object.wait()</code>(<code>Condition.await()</code>)和<code>Object.notifyAll()</code>(<code>Condition.signal()</code>)，用于实现线程间通信，一个Lock锁可以支持多个Condition。</p>
<p>一个使用Lock/Condition机制的例子：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> AA <span class="kw">implements</span> Runnable {
    Lock lock = <span class="kw">new</span> ReentrantLock();
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">run</span>() {
        lock.<span class="fu">lock</span>();
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;get lock&quot;</span>);
        <span class="co">// ...</span>
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;release lock&quot;</span>);
        lock.<span class="fu">unlock</span>();
    }
}</code></pre>
<p>在这里面，可以配合使用Condition完成较复杂的线程管理和调度。在<a href="http://blog.csdn.net/huang_xw/article/details/7090122">Java多线程之Condition接口的实现</a>一文中，作者使用<code>Condition/Lock</code>机制来实现了经典的“生产者-消费者”调度模型。在很多情景下，Condition提供了一种更加高效的、更有针对性的线程调度和同步方式。</p>
<h2 id="blockingqueue的使用">BlockingQueue的使用</h2>
<p>BlockingQueue,阻塞队列。BlockingQueue是一种特殊的Queue，若BlockingQueue是空的，从BlockingQueue取东西的操作将会被阻断进入等待状态直到BlocingkQueue进了新货才会被唤醒。同样，如果BlockingQueue是满的任何试图往里存东西的操作也会被阻断进入等待状态，直到BlockingQueue里有新的空间才会被唤醒继续操作。</p>
<p>BlockingQueue提供的方法主要有：</p>
<ol type="1">
<li><p><code>add(anObject)</code>: 把anObject加到BlockingQueue里，如果BlockingQueue可以容纳返回true，否则抛出IllegalStateException异常。</p></li>
<li><p><code>offer(anObject)</code>: 把anObject加到BlockingQueue里，如果BlockingQueue可以容纳返回true，否则返回false。</p></li>
<li><p><code>put(anObject)</code>: 把anObject加到BlockingQueue里，如果BlockingQueue没有空间，调用此方法的线程被阻断直到BlockingQueue里有新的空间再继续。</p></li>
<li><p><code>poll(time)</code>: 取出BlockingQueue里排在首位的对象，若不能立即取出可等time参数规定的时间。取不到时返回null。</p></li>
<li><p><code>take()</code>: 取出BlockingQueue里排在首位的对象，若BlockingQueue为空，阻断进入等待状态直到BlockingQueue有新的对象被加入为止。</p></li>
</ol>
<p>根据不同的需要BlockingQueue有4种具体实现：</p>
<ol type="1">
<li><code>ArrayBlockingQueue</code></li>
</ol>
<p>规定大小的BlockingQueue，其构造函数必须带一个int参数来指明其大小。其所含的对象是以FIFO（先入先出）顺序排序的。</p>
<ol start="2" type="1">
<li><code>LinkedBlockingQueue</code></li>
</ol>
<p>大小不定的BlockingQueue，若其构造函数带一个规定大小的参数，生成的BlockingQueue有大小限制。若不带大小参数，所生成的BlockingQueue的大小由Integer.MAX_VALUE来决定。其所含的对象是以FIFO（先入先出）顺序排序的。LinkedBlockingQueue和ArrayBlockingQueue比较起来，它们背后所用的数据结构不一样，导致LinkedBlockingQueue的数据吞吐量要大于ArrayBlockingQueue，但在线程数量很大时其性能的可预见性低于ArrayBlockingQueue。</p>
<ol start="3" type="1">
<li><code>PriorityBlockingQueue</code></li>
</ol>
<p>类似于LinkedBlockingQueue，但其所含对象的排序不是FIFO，而是依据对象的自然排序顺序或者是构造函数所带的Comparator决定的顺序。</p>
<ol start="4" type="1">
<li><code>SynchronousQueue</code></li>
</ol>
<p>特殊的BlockingQueue，对其的操作必须是放和取交替完成的。</p>
<p>BlockingQueue特别适用于线程间共享缓冲区的场景。BlockingQueue的四种实现也能够满足大多数的缓冲区调度需求。</p>
<h2 id="forkjoin">Fork/Join</h2>
<p>Fork/Join机制是JDK 7新增加的多线程框架，如果一个应用能被分解成多个子任务，并且组合多个子任务的结果就能够获得最终的答案，那么这个应用就适合用 Fork/Join 模式来解决。下图可大概说明Fork/Join模式的结构：</p>
<figure>
<img src="http://sighingnow.github.io/resource/java_thread/fork_join.png" alt="Fork/Join模式" /><figcaption>Fork/Join模式</figcaption>
</figure>
<h3 id="forkjoin框架的几个核心类">Fork/Join框架的几个核心类：</h3>
<ol type="1">
<li>ForkJoinPool: 线程池实现。实现了Work-stealing(工作窃取)算法，线程会主动寻找新创建的任务去执行，从而保证较高的线程利用率。程序运行时只需要唯一的一个ForkJoinPool。</li>
<li>ForkJoinTask: 任务类，有两个子类实现具体的Task：
<ol type="1">
<li>RecursiveAction: 无返回值；</li>
<li>RecursiveTask: 有返回值。</li>
</ol></li>
</ol>
<h3 id="使用forkjoin">使用Fork/Join</h3>
<p>首先，我们需要为程序创建一个ForkJoinPool：</p>
<blockquote>
<p>Creates a ForkJoinPool with parallelism equal to java.lang.Runtime.availableProcessors,</p>
</blockquote>
<pre><code>private static ForkJoinPool pool = new ForkJoinPool();</code></pre>
<p>这儿ForkJoinPool的构造函数有重载方法，可以通过参数设置线程数量（并行级别，parallelism level）以及ThreadFactory。</p>
<p>Task类需要实现compute方法，ForkJoinTask的代码框架：</p>
<pre><code>If (problem size &gt; default size){
    task s = divide(task);
    execute(tasks);
} 
else {
    resolve problem using another algorithm;
}</code></pre>
<h3 id="无返回值task的示例">无返回值Task的示例</h3>
<p>通过并行，将一个数组中每个元素的值都置为其索引值，即令<code>a[i] = i</code>。</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Task {
    <span class="co">// Creates a ForkJoinPool with parallelism equal to</span>
    <span class="co">// java.lang.Runtime.availableProcessors,</span>
    <span class="kw">private</span> <span class="dt">static</span> ForkJoinPool pool = <span class="kw">new</span> <span class="fu">ForkJoinPool</span>();
    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> default_size = <span class="dv">10</span>;

    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">solve</span>() {
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;available processor number: &quot;</span> +
                java.<span class="fu">lang</span>.<span class="fu">Runtime</span>.<span class="fu">getRuntime</span>().<span class="fu">availableProcessors</span>());
        <span class="dt">int</span>[] a = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">100</span>];
        SubTask task = <span class="kw">new</span> <span class="fu">SubTask</span>(a, <span class="dv">0</span>, <span class="dv">100</span>);
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;task start!&quot;</span>);
        pool.<span class="fu">invoke</span>(task);
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;task finish!&quot;</span>);
    }

    <span class="kw">class</span> SubTask <span class="kw">extends</span> RecursiveAction {
        <span class="dt">int</span>[] a;
        <span class="dt">int</span> l, r;

        <span class="kw">public</span> <span class="fu">SubTask</span>(<span class="dt">int</span>[] a, <span class="dt">int</span> l, <span class="dt">int</span> r) {
            <span class="kw">this</span>.<span class="fu">a</span> = a;
            <span class="kw">this</span>.<span class="fu">l</span> = l;
            <span class="kw">this</span>.<span class="fu">r</span> = r;
        }

        <span class="fu">@Override</span>
        <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">compute</span>() {
            System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Thread id: &quot;</span> + Thread.<span class="fu">currentThread</span>().<span class="fu">getId</span>());
            <span class="kw">if</span> (r - l &gt; BB.<span class="fu">default_size</span>) {
                <span class="dt">int</span> mid = (l + r) / <span class="dv">2</span>;
                <span class="fu">invokeAll</span>(<span class="kw">new</span> <span class="fu">SubTask</span>(a, l, mid + <span class="dv">1</span>), <span class="kw">new</span> <span class="fu">SubTask</span>(a, mid, r));
            }
            <span class="kw">else</span> {
                <span class="kw">for</span> (<span class="dt">int</span> i = l; i &lt; r; ++i) {
                    a[i] = i;
                }
            }
        }
    }
}</code></pre>
<h3 id="有返回值的task">有返回值的Task</h3>
<p>如果子任务有返回值，只需要改成继承<code>RecursiveTask</code>类，然后<code>compute</code>方法返回对应类型的返回值即可。例如：</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> SubTask <span class="kw">extends</span> RecursiveTask&lt;Integer&gt; {
    <span class="kw">public</span> Integer <span class="fu">compute</span>() {
        <span class="co">// ...</span>
    }
}

SubTask task = <span class="kw">new</span> <span class="fu">SubTask</span>(...);
Integer result = task.<span class="fu">get</span>()</code></pre>
<p>在fork子任务时，只需要：</p>
<pre class="sourceCode java"><code class="sourceCode java">SubTask t1 = <span class="kw">new</span> <span class="fu">SubTask</span>(...);
SubTask t2 = <span class="kw">new</span> <span class="fu">SubTask</span>(...);
<span class="fu">invokeAll</span>(t1, t2);
<span class="kw">try</span> {
    result = t1.<span class="fu">get</span>()+t2.<span class="fu">get</span>();  
} <span class="kw">catch</span> (InterruptedException | ExecutionException e) {  
    e.<span class="fu">printStackTrace</span>();  
}
<span class="kw">return</span> result;</code></pre>
<h3 id="异步执行task">异步执行Task</h3>
<p>上面两个示例都是同步执行的，invoke与invokeAll都是阻塞当前线程的。当Task线程运行时会阻塞父线程，而在很多场合，我们需要Task线程异步执行。这是需要使用到<code>execute</code>或者<code>submit</code>方法。<code>execute</code>方法直接执行task，而<code>submit</code>方法是将task提交到任务队列里边去。而<code>shutdown</code>方法则表示线程池不再接收新的task(ForkJoinPool是有守护线程的)(shutdown之后再submit后产生RejectedExecutionException)。ForkJoinPool线程池提供了execute()方法来异步启动任务，而作为任务本身，可以调用fork()方法异步启动新的子任务，并调用子任务的join()方法来取得计算结果。通过通过task.isDone()方法来判断任务是否结束。</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">allDone</span>(List&lt;SubTask&gt; tasks) {
    <span class="kw">for</span>(SubTask task: tasks) {
        <span class="kw">if</span>(!task.<span class="fu">isDone</span>()) {
            <span class="kw">return</span> <span class="kw">false</span>;
        }
    }
    <span class="kw">return</span> <span class="kw">true</span>;
}</code></pre>
<p>当使用Fork/Join框架时，如果主线程(main方法)先于task线程结束了，那么task线程也会结束，而不会等待执行完。这也是与Java中传统的Thread/Runnable有区别的地方。至于原因，应该是主线程(main方法)结束导致ForkJoinPool的守护线程结束了。此外，<code>ForkJoinPool</code>的<code>awaitTermination</code>方法也值得注意。<code>execute/submit/fork/join</code>也可以与<code>invoke/invokeAll</code>配合使用，来调整线程间的阻塞关系。</p>
<p>在<a href="http://www.ibm.com/developerworks/cn/java/j-lo-forkjoin/">JDK 7 中的 Fork/Join 模式</a>一文中，作者使用Fork/Join模式实现了并行快速排序算法，很值得参考。其实Fork/Join与Callable/Future/ExecutorService挺像的，ExecutorService与ForkJoinPool的API也很类似，ForkJoinPool比ExecutorService多出了Work-stealing(工作窃取)算法的调度，线程池和服务(Service)的概念对应地也能很好。在Fork/Join机制中，Task也是可以取消(cancel)的。</p>
<h3 id="invoke与fork差异">invoke与fork差异</h3>
<p>这两个方法有很大的区别，当使用同步方法，调用这些方法（比如：invokeAll()方法）的任务将被阻塞，直到提交给线程池的任务完成它的执行。这允许ForkJoinPool类使用work-stealing算法，分配一个新的任务给正在执行睡眠任务的工作线程。反之，当使用异步方法（比如：fork()方法），这个任务将继续它的执行，所以ForkJoinPool类不能使用work-stealing算法来提高应用程序的性能。在这种情况下，只有当你调用join()或get()方法来等待任务的完成时，ForkJoinPool才能使用work-stealing算法。</p>
<h3 id="work-stealing">Work-stealing</h3>
<p>工作窃取（work-stealing）算法是指某个线程从其他队列里窃取任务来执行。核心思想在于以下两点：</p>
<ol type="1">
<li>将一个任务分解为多个互不依赖的子任务。</li>
<li>当一个线程完成自己队列中的任务后，将其他线程的任务队列里的任务取出来执行。</li>
</ol>
<figure>
<img src="http://sighingnow.github.io/resource/java_thread/work-stealing.png" alt="Work-stealing算法示意图" /><figcaption>Work-stealing算法示意图</figcaption>
</figure>
<h2 id="disruptor机制">Disruptor机制</h2>
<p>单核情形下提高CPU利用率。</p>
<h2 id="参考">参考</h2>
<ol type="1">
<li><a href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html">Java 理论与实践: 正确使用 Volatile 变量</a></li>
<li><a href="http://www.iteye.com/topic/260515">用happen-before规则重新审视DCL</a></li>
<li><a href="http://blog.csdn.net/huang_xw/article/details/7090122">Java多线程之Condition接口的实现</a></li>
<li><a href="http://ifeve.com/reentrantlock-and-fairness/">ReentrantLock(重入锁)以及公平性</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-lo-forkjoin/">JDK 7 中的 Fork/Join 模式</a></li>
<li><a href="http://www.slideshare.net/hongjiang/java7-fork-join-framework-and-closures">java 7 fork-join framework and closures</a></li>
<li><a href="http://ifeve.com/talk-concurrency-forkjoin">聊聊并发（八）——Fork/Join框架介绍</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/java/j-jtp10264/index.html">Java 理论与实践: JDK 5.0 中更灵活、更具可伸缩性的锁定机制</a></li>
<li><a href="http://www.oracle.com/technetwork/articles/java/fork-join-422606.html">Fork and Join: Java Can Excel at Painless Parallel Programming Too!</a></li>
<li><a href="http://blog.csdn.net/andycpp/article/details/8903155">Java线程之fork/join框架</a></li>
<li><a href="http://it.deepinmind.com/%E5%B9%B6%E5%8F%91/2015/01/22/forkjoin-framework-vs-parallel-streams-vs-executorservice-the-ultimate-benchmark.html">Java中不同的并发实现的性能比较</a></li>
<li><a href="http://www.importnew.com/14506.html">Java并发的四种风味：Thread、Executor、ForkJoin和Actor</a></li>
</ol>

        <br/>
        <span class="fa fa-tag"></span>Tags:
        
          		
            <a href="/tags#Java"><span class="label label-primary">Java</span></a>
          		
            <a href="/tags#并发模型"><span class="label label-primary">并发模型</span></a>
          
        
        <br/><br/>
        <br/><br/><h3>Comments:</h3>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'sighingnow';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </article> 
      
      <div class="row">
        <div class="col-sm-6 col-xs-6 text-left">
       	
        	<a class="btn btn-blue" href="/algorithm/double_divisors_number.html">← Previous</a>
        
        </div>
        <div class="col-sm-6 col-xs-6 text-right">
        
        	<a class="btn btn-blue" href="/%E7%A4%BE%E4%BC%9A%E7%BD%91%E7%BB%9C/social_network_ranking_algorithm.html">Next →</a>
         
        </div>
      </div>
      
      <footer class="row">
      <div class="col-ms-12 text-center"><div id="clustrmaps-widget" style="margin-left: auto; margin-right: auto;"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://sighingnow.github.io', 'user' : 1175527, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2015-08-01', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/4e211efe7"><img src="http://www3.clustrmaps.com/stats/maps-no_clusters/sighingnow.github.io-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>

</div>
      <div class="col-ms-12 text-center">
            <hr/>
            
                  <div>
<a href="mailto:sighingnow@gmail.com"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.224580688,30 C0.224580688,13.4314567 13.454941,0 29.7754193,0 C46.0958976,0 59.3262579,13.4314567 59.3262579,30 C59.3262579,46.5685433 46.0958976,60 29.7754193,60 C13.454941,60 0.224580688,46.5685433 0.224580688,30 Z M0.224580688,30" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M35.0384324,31.6384006 L47.2131148,40.5764264 L47.2131148,20 L35.0384324,31.6384006 Z M13.7704918,20 L13.7704918,40.5764264 L25.9449129,31.6371491 L13.7704918,20 Z M30.4918033,35.9844891 L27.5851037,33.2065217 L13.7704918,42 L47.2131148,42 L33.3981762,33.2065217 L30.4918033,35.9844891 Z M46.2098361,20 L14.7737705,20 L30.4918033,32.4549304 L46.2098361,20 Z M46.2098361,20" id="Shape" fill="#333333" sketch:type="MSShapeGroup"></path>
    <path d="M59.3262579,30 C59.3262579,46.5685433 46.0958976,60 29.7754193,60 C23.7225405,60 18.0947051,58.1525134 13.4093244,54.9827754 L47.2695458,5.81941103 C54.5814438,11.2806503 59.3262579,20.0777973 59.3262579,30 Z M59.3262579,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>
<a href="http://facebook.com/sighingnow"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#3B5998" sketch:type="MSShapeGroup"></path>
	<path d="M32.1341457,46.3196729 L32.1341457,29.9980891 L36.5657565,29.9980891 L37.1530406,24.3735809 L32.1341457,24.3735809 L32.141675,21.5584604 C32.141675,20.091502 32.2787707,19.3054722 34.351206,19.3054722 L37.1216686,19.3054722 L37.1216686,13.6803271 L32.6894304,13.6803271 C27.3655995,13.6803271 25.491749,16.4088187 25.491749,20.9972835 L25.491749,24.3742179 L22.1732173,24.3742179 L22.1732173,29.998726 L25.491749,29.998726 L25.491749,46.3196729 L32.1341457,46.3196729 Z M32.1341457,46.3196729" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
	<path d="M59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C23.6102502,60 17.9824147,58.1525134 13.2970341,54.9827754 L47.1572554,5.81941103 C54.4691534,11.2806503 59.2139676,20.0777973 59.2139676,30 Z M59.2139676,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>

<a href="http://github.com/sighingnow"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.336871032,30 C0.336871032,13.4314567 13.5672313,0 29.8877097,0 C46.208188,0 59.4385483,13.4314567 59.4385483,30 C59.4385483,46.5685433 46.208188,60 29.8877097,60 C13.5672313,60 0.336871032,46.5685433 0.336871032,30 Z M0.336871032,30" id="Github" fill="#333333" sketch:type="MSShapeGroup"></path>
    <path d="M18.2184245,31.9355566 C19.6068506,34.4507902 22.2845295,36.0156764 26.8007287,36.4485173 C26.1561023,36.9365335 25.3817877,37.8630984 25.2749857,38.9342607 C24.4644348,39.4574749 22.8347506,39.62966 21.5674303,39.2310659 C19.7918469,38.6717023 19.1119377,35.1642642 16.4533306,35.6636959 C15.8773626,35.772144 15.9917933,36.1507609 16.489567,36.4722998 C17.3001179,36.9955141 18.0629894,37.6500075 18.6513541,39.04366 C19.1033554,40.113871 20.0531304,42.0259813 23.0569369,42.0259813 C24.2489236,42.0259813 25.0842679,41.8832865 25.0842679,41.8832865 C25.0842679,41.8832865 25.107154,44.6144649 25.107154,45.6761142 C25.107154,46.9004355 23.4507693,47.2457569 23.4507693,47.8346108 C23.4507693,48.067679 23.9990832,48.0895588 24.4396415,48.0895588 C25.3102685,48.0895588 27.1220883,47.3646693 27.1220883,46.0918317 C27.1220883,45.0806012 27.1382993,41.6806599 27.1382993,41.0860982 C27.1382993,39.785673 27.8372803,39.3737607 27.8372803,39.3737607 C27.8372803,39.3737607 27.924057,46.3153869 27.6704022,47.2457569 C27.3728823,48.3397504 26.8360115,48.1846887 26.8360115,48.6727049 C26.8360115,49.3985458 29.0168704,48.8505978 29.7396911,47.2571725 C30.2984945,46.0166791 30.0543756,39.2072834 30.0543756,39.2072834 L30.650369,39.1949165 C30.650369,39.1949165 30.6837446,42.3123222 30.6637192,43.7373675 C30.6427402,45.2128317 30.5426134,47.0792797 31.4208692,47.9592309 C31.9977907,48.5376205 33.868733,49.5526562 33.868733,48.62514 C33.868733,48.0857536 32.8436245,47.6424485 32.8436245,46.1831564 L32.8436245,39.4688905 C33.6618042,39.4688905 33.5387911,41.6768547 33.5387911,41.6768547 L33.5988673,45.7788544 C33.5988673,45.7788544 33.4186389,47.2733446 35.2190156,47.8992991 C35.8541061,48.1209517 37.2139245,48.1808835 37.277815,47.8089257 C37.3417055,47.4360167 35.6405021,46.8814096 35.6252446,45.7236791 C35.6157088,45.0178155 35.6567131,44.6059032 35.6567131,41.5379651 C35.6567131,38.470027 35.2438089,37.336079 33.8048426,36.4323453 C38.2457082,35.9766732 40.9939527,34.880682 42.3337458,31.9450695 C42.4383619,31.9484966 42.8791491,30.5737742 42.8219835,30.5742482 C43.1223642,29.4659853 43.2844744,28.1550957 43.3168964,26.6025764 C43.3092677,22.3930799 41.2895654,20.9042975 40.9014546,20.205093 C41.4736082,17.0182425 40.8060956,15.5675121 40.4961791,15.0699829 C39.3518719,14.6637784 36.5149435,16.1145088 34.9653608,17.1371548 C32.438349,16.3998984 27.0982486,16.4712458 25.0957109,17.3274146 C21.4005522,14.6875608 19.445694,15.0918628 19.445694,15.0918628 C19.445694,15.0918628 18.1821881,17.351197 19.1119377,20.6569598 C17.8961113,22.2028201 16.9902014,23.2968136 16.9902014,26.1963718 C16.9902014,27.8297516 17.1828264,29.2918976 17.6176632,30.5685404 C17.5643577,30.5684093 18.2008493,31.9359777 18.2184245,31.9355566 Z M18.2184245,31.9355566" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M59.4385483,30 C59.4385483,46.5685433 46.208188,60 29.8877097,60 C23.8348308,60 18.2069954,58.1525134 13.5216148,54.9827754 L47.3818361,5.81941103 C54.6937341,11.2806503 59.4385483,20.0777973 59.4385483,30 Z M59.4385483,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>

<a href="http://linkedin.com/in/pub/%E6%B6%9B-%E4%BD%95/bb/868/732"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.449161376,30 C0.449161376,13.4314567 13.6795217,0 30,0 C46.3204783,0 59.5508386,13.4314567 59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C13.6795217,60 0.449161376,46.5685433 0.449161376,30 Z M0.449161376,30" fill="#007BB6" sketch:type="MSShapeGroup"></path>
    <path d="M22.4680392,23.7098144 L15.7808366,23.7098144 L15.7808366,44.1369537 L22.4680392,44.1369537 L22.4680392,23.7098144 Z M22.4680392,23.7098144" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M22.9084753,17.3908761 C22.8650727,15.3880081 21.4562917,13.862504 19.1686418,13.862504 C16.8809918,13.862504 15.3854057,15.3880081 15.3854057,17.3908761 C15.3854057,19.3522579 16.836788,20.9216886 19.0818366,20.9216886 L19.1245714,20.9216886 C21.4562917,20.9216886 22.9084753,19.3522579 22.9084753,17.3908761 Z M22.9084753,17.3908761" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M46.5846502,32.4246563 C46.5846502,26.1503226 43.2856534,23.2301456 38.8851658,23.2301456 C35.3347011,23.2301456 33.7450983,25.2128128 32.8575489,26.6036896 L32.8575489,23.7103567 L26.1695449,23.7103567 C26.2576856,25.6271338 26.1695449,44.137496 26.1695449,44.137496 L32.8575489,44.137496 L32.8575489,32.7292961 C32.8575489,32.1187963 32.9009514,31.5097877 33.0777669,31.0726898 C33.5610713,29.8530458 34.6614937,28.5902885 36.5089747,28.5902885 C38.9297703,28.5902885 39.8974476,30.4634101 39.8974476,33.2084226 L39.8974476,44.1369537 L46.5843832,44.1369537 L46.5846502,32.4246563 Z M46.5846502,32.4246563" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M59.5508386,30 C59.5508386,46.5685433 46.3204783,60 30,60 C23.9471212,60 18.3192858,58.1525134 13.6339051,54.9827754 L47.4941264,5.81941103 C54.8060245,11.2806503 59.5508386,20.0777973 59.5508386,30 Z M59.5508386,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>
<a href="http://pinterest.com/sighingnow"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.883833675,30 C0.883833675,13.4314567 13.9008011,0 29.9580459,0 C46.0152907,0 59.0322581,13.4314567 59.0322581,30 C59.0322581,46.5685433 46.0152907,60 29.9580459,60 C13.9008011,60 0.883833675,46.5685433 0.883833675,30 Z M0.883833675,30" fill="#CB2027" sketch:type="MSShapeGroup"></path>
    <path d="M17.5869165,25.6564894 C17.5869165,28.9590618 18.7986851,31.8971698 21.3976941,32.9920559 C21.8238696,33.1718356 22.2056087,32.9982405 22.3292037,32.5113638 C22.4151829,32.1744101 22.6185566,31.3243485 22.7092894,30.9703339 C22.8339179,30.4887888 22.7855546,30.3198854 22.441638,29.9001862 C21.692214,28.9880654 21.213335,27.8072348 21.213335,26.1346224 C21.213335,21.2820631 24.7318662,16.93792 30.3754877,16.93792 C35.3728188,16.93792 38.1183644,20.08865 38.1183644,24.2965188 C38.1183644,29.8330087 35.7438106,34.5057882 32.2186656,34.5057882 C30.2719407,34.5057882 28.8146355,32.8444787 29.2817337,30.8069754 C29.8410115,28.3745112 30.9244314,25.7492583 30.9244314,23.9934738 C30.9244314,22.4217342 30.1068028,21.1108139 28.4147084,21.1108139 C26.4245806,21.1108139 24.8259058,23.2351148 24.8259058,26.0808804 C24.8259058,27.8933925 25.4194926,29.1192214 25.4194926,29.1192214 C25.4194926,29.1192214 23.3828616,38.0231153 23.0259242,39.5824856 C22.3149428,42.6880041 22.9190703,46.4949407 22.9701204,46.8794518 C23.0000891,47.1072154 23.2838616,47.1613839 23.412417,46.9892816 C23.5959494,46.7421112 25.9661629,43.7227504 26.7720107,40.7057356 C26.9999795,39.8514088 28.0809192,35.427719 28.0809192,35.427719 C28.7274162,36.7002523 30.6170973,37.8211564 32.6266532,37.8211564 C38.6088176,37.8211564 42.6674052,32.1938169 42.6674052,24.6614098 C42.6674052,18.9658266 37.9920825,13.6613656 30.8861955,13.6613656 C22.0448112,13.6613656 17.5869165,20.2021053 17.5869165,25.6564894 Z M17.5869165,25.6564894" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M59.0322581,30 C59.0322581,46.5685433 46.0152907,60 29.9580459,60 C24.0027941,60 18.4657302,58.1525134 13.8559203,54.9827754 L47.170009,5.81941103 C54.3639732,11.2806503 59.0322581,20.0777973 59.0322581,30 Z M59.0322581,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>
<a href="/feed.xml"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0.112290344,30 C0.112290344,13.4314567 13.3426506,0 29.663129,0 C45.9836073,0 59.2139676,13.4314567 59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C13.3426506,60 0.112290344,46.5685433 0.112290344,30 Z M0.112290344,30" fill="#E18F00" sketch:type="MSShapeGroup"></path>
    <path d="M26.5147755,38.7571296 C26.5147755,36.8192934 24.9575021,35.2291656 23.0297047,35.2291656 C21.1094331,35.2291656 19.5492775,36.8192934 19.5492775,38.7571296 C19.5492775,40.7052068 21.1094331,42.277616 23.0297047,42.277616 C24.957422,42.277616 26.5146954,40.7052881 26.5147755,38.7571296 Z M36.8075433,42.2700571 C36.8075433,32.6055847 29.062648,24.7442705 19.5492775,24.7442705 L19.5492775,29.8318017 C22.8128986,29.8318017 25.8817303,31.1272145 28.1920609,33.4740429 C30.4999895,35.8159133 31.7732853,38.9454513 31.7732853,42.2701384 L36.8075433,42.2700571 Z M45.6871482,42.2675375 C45.6871482,27.6346878 33.9604014,15.722384 19.5492775,15.722384 L19.5492775,20.8123535 C31.186916,20.8123535 40.660496,30.438869 40.660496,42.2673749 L45.6871482,42.2675375 Z M45.6871482,42.2675375" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M59.2139676,30 C59.2139676,46.5685433 45.9836073,60 29.663129,60 C23.6102502,60 17.9824147,58.1525134 13.2970341,54.9827754 L47.1572554,5.81941103 C54.4691534,11.2806503 59.2139676,20.0777973 59.2139676,30 Z M59.2139676,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>
<a href="http://twitter.com/sighingnow"><svg width="40px" height="40px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    <path d="M0,30 C0,13.4314567 13.4508663,0 30.0433526,0 C46.6358389,0 60.0867052,13.4314567 60.0867052,30 C60.0867052,46.5685433 46.6358389,60 30.0433526,60 C13.4508663,60 0,46.5685433 0,30 Z M0,30" fill="#4099FF" sketch:type="MSShapeGroup"></path>
    <path d="M29.2997675,23.8879776 L29.3627206,24.9260453 L28.3135016,24.798935 C24.4943445,24.3116787 21.1578281,22.6592444 18.3249368,19.8840023 L16.9399677,18.5069737 L16.5832333,19.5238563 C15.8277956,21.7906572 16.3104363,24.1845684 17.8842648,25.7946325 C18.72364,26.6844048 18.5347806,26.8115152 17.0868584,26.2818888 C16.5832333,26.1124083 16.1425613,25.985298 16.1005925,26.0488532 C15.9537019,26.1971486 16.457327,28.1249885 16.8560302,28.8876505 C17.4016241,29.9469033 18.5137962,30.9849709 19.7308902,31.5993375 L20.7591248,32.0865938 L19.5420308,32.1077788 C18.3669055,32.1077788 18.3249368,32.1289639 18.4508431,32.57385 C18.8705307,33.9508786 20.5282967,35.4126474 22.3749221,36.048199 L23.6759536,36.4930852 L22.5427971,37.1710069 C20.8640467,38.1455194 18.891515,38.6963309 16.9189833,38.738701 C15.9746862,38.759886 15.1982642,38.8446262 15.1982642,38.9081814 C15.1982642,39.1200319 17.7583585,40.306395 19.2482495,40.7724662 C23.7179224,42.1494948 29.0269705,41.5563132 33.0140027,39.2047722 C35.846894,37.5311528 38.6797853,34.2050993 40.0018012,30.9849709 C40.7152701,29.2689815 41.428739,26.1335934 41.428739,24.6294545 C41.428739,23.654942 41.4916922,23.5278317 42.6668174,22.3626537 C43.359302,21.6847319 44.0098178,20.943255 44.135724,20.7314044 C44.3455678,20.3288884 44.3245835,20.3288884 43.2543801,20.6890343 C41.4707078,21.324586 41.2188952,21.2398458 42.1002392,20.2865183 C42.750755,19.6085965 43.527177,18.3798634 43.527177,18.0197174 C43.527177,17.9561623 43.2124113,18.0620876 42.8556769,18.252753 C42.477958,18.4646036 41.6385828,18.7823794 41.0090514,18.9730449 L39.8758949,19.3331908 L38.8476603,18.634084 C38.281082,18.252753 37.4836756,17.829052 37.063988,17.7019416 C35.9937846,17.4053509 34.357003,17.447721 33.3917215,17.7866818 C30.768674,18.7400093 29.110908,21.1974757 29.2997675,23.8879776 Z M29.2997675,23.8879776" id="Path" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>
    <path d="M60.0867052,30 C60.0867052,46.5685433 46.6358389,60 30.0433526,60 C23.8895925,60 18.1679598,58.1525134 13.4044895,54.9827754 L47.8290478,5.81941103 C55.2628108,11.2806503 60.0867052,20.0777973 60.0867052,30 Z M60.0867052,30" id="reflec" fill-opacity="0.08" fill="#000000" sketch:type="MSShapeGroup"></path>
</svg></a>
<a href="https://plus.google.com/102570111351055130345"><svg width="40" height="40" xmlns="http://www.w3.org/2000/svg">

 <g>
  <title>background</title>
  <rect fill="none" id="canvas_background" height="42" width="42" y="-1" x="-1"/>
 </g>
 <g>
  <title>Google+</title>
  <g stroke="null" id="svg_1">
   <circle stroke="null" id="svg_2" r="20" fill-rule="evenodd" fill="#E02F2F" cy="20" cx="20" clip-rule="evenodd"/>
   <g stroke="null" id="svg_3">
    <path stroke="null" id="svg_4" fill="#FFFFFF" d="m23.9375,7.4975c0,0 -6.027,0 -8.09025,0c-3.70125,0 -7.18594,2.47375 -7.18594,5.56625c0,3.16 2.52262,5.6175 6.28819,5.6175c0.2625,0 0.51712,-0.05625 0.7665,-0.07375c-0.24675,0.44375 -0.41737,0.92125 -0.41737,1.4425c0,0.87875 0.49481,1.58 1.12087,2.16125c-0.46988,0 -0.93056,0.00625 -1.43062,0.00625c-4.58456,0.00125 -8.11388,2.78 -8.11388,5.66375c0,2.84 3.86925,4.61875 8.45381,4.61875c5.22769,0 8.11519,-2.8275 8.11519,-5.6675c0,-2.27625 -0.70613,-3.64125 -2.88619,-5.11375c-0.74681,-0.50125 -2.1735,-1.725 -2.1735,-2.445c0,-0.8425 0.252,-1.2575 1.5855,-2.25c1.36369,-1.015 2.331,-2.22625 2.331,-3.88875c0,-1.97625 -0.8925,-4.3875 -2.62894,-4.3875l2.95313,0l1.3125,-1.25zm-2.71556,18.8425c0.063,0.265 0.10106,0.53625 0.10106,0.81125c0,2.295 -1.55531,4.08875 -6.01125,4.08875c-3.16969,0 -5.45737,-1.91 -5.45737,-4.205c0,-2.24875 2.83894,-4.1225 6.00994,-4.08875c0.73763,0.0075 1.428,0.12125 2.05275,0.31125c1.72069,1.14125 2.95444,1.785 3.30487,3.0825zm-5.07675,-8.56125c-2.12756,-0.05875 -4.15012,-2.26625 -4.51631,-4.925c-0.36619,-2.6625 1.0605,-4.69875 3.18675,-4.63875c2.12625,0.0625 4.15012,2.1975 4.51631,4.8575c0.3675,2.66 -1.05919,4.76625 -3.18675,4.70625z"/>
    <polygon stroke="null" id="svg_5" points="30.5,17.488750457763672 30.5,13.738750457763672 27.875,13.738750457763672 27.875,17.488750457763672 23.9375,17.488750457763672 23.9375,19.988750457763672 27.875,19.988750457763672 27.875,23.73874855041504 30.5,23.73874855041504 30.5,19.988750457763672 34.4375,19.988750457763672 34.4375,17.488750457763672 " fill="#FFFFFF"/>
   </g>
  </g>
  <g id="svg_6"/>
  <g id="svg_7"/>
  <g id="svg_8"/>
  <g id="svg_9"/>
  <g id="svg_10"/>
  <g id="svg_11"/>
 </g>
</svg></a>
<a href="http://stackoverflow.com/users/5080177/he-tao"><svg width="40" height="40" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <path fill="#919191" d="m7.294075,23.110188l2.385864,0.023237l-0.083177,10.552679l15.878221,0l0,-10.514505l2.51405,0l0,13.07741l-20.707843,0l0.01289,-13.138815l-0.000005,-0.000006z"/>
  <rect fill="#919191" y="29.348862" x="11.184582" height="2.628626" width="12.437938"/>
  <rect fill="#a78b68" transform="matrix(0.5395733410304717,0.05172669848399204,-0.05207586478003252,0.5359555264108665,3.6611416648678325,1.4067255727666614) " y="41.524347" x="18.49125" height="5.003923" width="23.066864"/>
  <rect fill="#c19653" transform="matrix(0.5216998676238958,0.14625586092278992,-0.1472431193160242,0.5182018938275416,3.6611416648678325,1.4067255727666614) " y="27.438515" x="24.907076" height="5.003923" width="23.066864"/>
  <rect fill="#d48c28" transform="matrix(0.4640090244261216,0.2783830739288475,-0.2802622193151353,0.46089786509976993,3.6611416648678325,1.4067255727666614) " y="7.461092" x="30.089396" height="5.003923" width="23.066864"/>
  <rect fill="#fe8908" transform="matrix(0.3157222700143304,0.4376935608999602,-0.4406480862019664,0.31360536660688737,3.6611416648678325,1.4067255727666614) " y="-20.343803" x="28.488303" height="5.003923" width="23.066864"/>
  <rect fill="#ff7a15" transform="matrix(0.0893402304821676,0.5310828333843179,-0.5346677562821299,0.08874120831524585,3.6611416648678325,1.4067255727666614) " y="-47.045927" x="14.158203" height="5.003923" width="23.066864"/>
</svg>
</a>
</div>
            
            &copy; 2016 - Sighingnow. All rights reserved.<br/>
            Built using 
            
            <a href="http://jekyllrb.com/">Jekyll</a>
             and Theme proudly powered by <a href="https://github.com/olakara/JekyllMetro">JekyllMetro.</a> 
      </div>
</footer>


      <!-- Mathjax config template. -->

<style type="text/css">
  span.MathJax_SVG { zoom : 1.0; }
</style>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
          processEscapes: true
        },
        // displayAlign: "left",
        // displayIndent: "0em",
    });
    MathJax.Hub.Queue(["Typeset",MathJax.Hub,document.body]);
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG" type="text/javascript"></script>



    
    </div> <!-- content area column -->
  </div> <!-- row  -->
</div> <!-- container -->
      
      
      
	  

    <!-- <script>
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

ga('create', '', 'blog-olakara.rhcloud.com');
ga('send', 'pageview');
</script>
 -->
    <a href="#" class="scrollToTop"></a>
	<script type="text/javascript">
    $(document).ready(function(){
    
    //Check to see if the window is top if not then display button
    $(window).scroll(function(){
        if ($(this).scrollTop() > 100) {
            $('.scrollToTop').fadeIn();
        } else {
            $('.scrollToTop').fadeOut();
        }
    });
    
    //Click event to scroll to top
    $('.scrollToTop').click(function(){
        $('html, body').animate({scrollTop : 0},800);
        return false;
    });
    
});
</script>
  </body>
</html>

