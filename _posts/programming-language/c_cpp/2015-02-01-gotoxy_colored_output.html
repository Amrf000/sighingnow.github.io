---
title: C语言控制台程序光标位置与文字颜色
author: He Tao
date: 2015-02-01
tag: C/C++
category: 编程语言
layout: post
---

<h2 id="windows平台">Windows平台</h2>
<h3 id="控制光标定位">控制光标定位</h3>
<p>Windows环境下可以通过调用WIN32 API来实现光标定位，具体实现如下:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;windows.h&gt;</span>
<span class="dt">void</span> gotoxy(<span class="dt">int</span> x, <span class="dt">int</span> y) {
    COORD cursorPosition;
    cursorPosition.X = x;
    cursorPosition.Y = y;
    <span class="co">// COORD cursorPosition = {x, y};</span>
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), cursorPosition);
}</code></pre>
<p><strong>注意</strong>：X, Y 的值都是从 <code>0</code> 开始的。</p>
<!--more-->
<h3 id="隐藏光标">隐藏光标</h3>
<p>有了光标定位的基础，只需要将光标定位于控制台之外的为，便可以实现隐藏光标，例如，通过上文中实现的<code>gotoxy</code>函数将光标定位于<code>(-1, -1)</code> 位置便可以实现隐藏光标。</p>
<h3 id="清屏">清屏</h3>
<p>Windows环境下可以通过执行cls命令来实现清屏，具体实现如下：</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;windows.h&gt;</span>
<span class="dt">void</span> clear() {
    system(<span class="st">&quot;cls&quot;</span>);
}</code></pre>
<h3 id="color命令">color命令</h3>
<p>在cmd命令行中执行 <code>color /?</code>，可以得到color命令的用法如下：</p>
<pre><code>设置默认的控制台前景和背景颜色。
COLOR [attr]
    attr        指定控制台输出的颜色属性
颜色属性由两个十六进制数字指定 -- 第一个为背景，第二个则为
前景。每个数字可以为以下任何值之一:

    0 = 黑色       8 = 灰色
    1 = 蓝色       9 = 淡蓝色
    2 = 绿色       A = 淡绿色
    3 = 浅绿色     B = 淡浅绿色
    4 = 红色       C = 淡红色
    5 = 紫色       D = 淡紫色
    6 = 黄色       E = 淡黄色
    7 = 白色       F = 亮白色

如果没有给定任何参数，该命令会将颜色还原到 CMD.EXE 启动时
的颜色。这个值来自当前控制台窗口、/T 命令行开关或 
DefaultColor 注册表值。

如果用相同的前景和背景颜色来执行 COLOR 命令，COLOR 命令
会将 ERRORLEVEL 设置为 1。

例如: &quot;COLOR fc&quot; 在亮白色上产生亮红色</code></pre>
<p>程序中，也可以通过 <code>system(&quot;color ... &quot;)</code> 调用color命令来实现改变控制台颜色的功能。</p>
<h3 id="彩色输出">彩色输出</h3>
<p>在Windows环境下，同样是通过调用WIN32 API来实现控制台程序的彩色输出。具体实现如下：</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#include &lt;windows.h&gt;</span>
<span class="dt">void</span> settextcolor(<span class="dt">int</span> color)
{
    SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), color);
}</code></pre>
<p>其中，color的值定义在 wincon.h 中。多个颜色值可以综合在一起使用。具体颜色定义如下:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#define FOREGROUND_BLUE 1</span>
<span class="ot">#define FOREGROUND_GREEN    2</span>
<span class="ot">#define FOREGROUND_RED  4</span>
<span class="ot">#define FOREGROUND_INTENSITY    8</span>
<span class="ot">#define BACKGROUND_BLUE 16</span>
<span class="ot">#define BACKGROUND_GREEN    32</span>
<span class="ot">#define BACKGROUND_RED  64</span>
<span class="ot">#define BACKGROUND_INTENSITY    128</span></code></pre>
<p>多个值综合使用示例：(本质上为多个值得或运算)</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 
        FOREGROUND_GREEN|FOREGROUND_RED|FOREGROUND_INTENSITY);</code></pre>
<p>便可以在控制台将输出字符的颜色设置为黄色。</p>
<h2 id="linux-平台">Linux 平台</h2>
<h3 id="控制光标定位-1">控制光标定位</h3>
<p>Linux环境下，控制台会解释ANSI转义序列，转义符是ESC，ASCII码为0x1b，因此，可以通过在中断输出转义序列来实现光标的定位，具体序列如下：</p>
<pre><code>Esc[Line;Columnf</code></pre>
<p>或</p>
<pre><code>Esc[Line;ColumnH</code></pre>
<p>应用举例：</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">void</span> gotoxy(<span class="dt">int</span> x, <span class="dt">int</span> y) {
    printf(<span class="st">&quot;</span><span class="ch">%c</span><span class="st">[</span><span class="ch">%d</span><span class="st">;</span><span class="ch">%d</span><span class="st">f&quot;</span>, <span class="bn">0x1b</span>, y, x);
    <span class="co">// printf(&quot;%c[%d;%dH&quot;, 0x1b, y, x);</span>
}</code></pre>
<p><strong>注意</strong>: 光标位置的行和列都是从 <code>0</code> 开始索引。</p>
<p>转义序列列表：</p>
<ul>
<li>Esc[PnA 光标向上移动Pn行，如果光标已经处于最上方(the top line)，则忽略该转义序列。</li>
<li>Esc[PnB 光标向下移动Pn行，如果光标已经处于最下方(the buttom line)，则忽略该转义序列。</li>
<li>Esc[PnC 光标向右移动Pn行，如果光标已经处于最右处(the rightmost column)，则忽略该转义序列。</li>
<li>Esc[PnD 光标向左移动Pn行，如果光标已经处于最左处(the leftmost column)，则忽略该转义序列。</li>
<li>Esc[s 保存当前光标位置，之后可以通过恢复光标位置的转义序列回到被保存的光标位置。</li>
<li>Esc[u 恢复光标位置，将光标置于 Esc[s 序列保存的光标位置。</li>
<li>Esc[2J 清屏，将光标置于(0, 0)处(第一行第一列)。</li>
<li>Esc[K 删除从光标所在位置至当前行行末的所有字符，包括当前光标所在位置处的字符。</li>
<li>Esc[?25l 隐藏光标。</li>
<li>Esc[?25h 显示光标。</li>
</ul>
<h3 id="设置输出字符颜色">设置输出字符颜色</h3>
<p>同样，也可以通过输出控制符来控制输出字符的颜色，用法如下：</p>
<ul>
<li>Esc[Ps;Psm 设置图形模式(Set Graphics Mode)。第一个Ps的值为背景色的值，第二个Ps的值为前景色的值。</li>
</ul>
<p>背景色的颜色值范围为<code>40~49</code>，前景色的颜色值范围为<code>30-39</code>，具体颜色值如下：</p>
<table>
<thead>
<tr class="header">
<th align="center">Color</th>
<th align="center">Background</th>
<th align="center">Foreground</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">black</td>
<td align="center">40</td>
<td align="center">30</td>
</tr>
<tr class="even">
<td align="center">red</td>
<td align="center">41</td>
<td align="center">31</td>
</tr>
<tr class="odd">
<td align="center">green</td>
<td align="center">42</td>
<td align="center">32</td>
</tr>
<tr class="even">
<td align="center">yellow</td>
<td align="center">43</td>
<td align="center">33</td>
</tr>
<tr class="odd">
<td align="center">blue</td>
<td align="center">44</td>
<td align="center">34</td>
</tr>
<tr class="even">
<td align="center">purple</td>
<td align="center">45</td>
<td align="center">35</td>
</tr>
<tr class="odd">
<td align="center">deep green</td>
<td align="center">46</td>
<td align="center">36</td>
</tr>
<tr class="even">
<td align="center">white</td>
<td align="center">47</td>
<td align="center">37</td>
</tr>
</tbody>
</table>
<h3 id="其他转义序列控制">其他转义序列控制</h3>
<ul>
<li>Esc[0m 关闭所有属性。</li>
<li>Esc[1m 设置高亮度。</li>
<li>Esc[4m 下划线。</li>
<li>Esc[5m 闪烁。</li>
<li>Esc[7m 反显。</li>
<li>Esc[8m 消隐。</li>
</ul>
