---
title: C语言中的函数指针
author: He Tao
date: 2015-02-02
tag: C/C++
category: 编程语言
layout: post
---

<p>函数指针是C语言的灵魂之一，基于C语言实现的面向对象，底层都以函数指针为基础。</p>
<h2 id="函数指针的定义">函数指针的定义</h2>
<p>C语言中，可以通过以下方式定义函数指针：</p>
<pre><code>type (*fn)(args)</code></pre>
<p>其中，<code>fn</code>为指针变量名，<code>type</code>为指针所指向的函数的返回值类型，<code>args</code>为指针所指向的函数的参数列表。可以通过<code>&amp;</code>运算符对函数指针赋值，通过<code>(*fn)()</code>的方式调用。举例：</p>
<!--more-->
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">int</span> (*fn)(<span class="dt">int</span> a);

<span class="dt">int</span> func(<span class="dt">int</span> a) {
    printf(<span class="st">&quot;call func, arg a = </span><span class="ch">%d\n</span><span class="st">&quot;</span>, a);
    <span class="kw">return</span> a;
}

<span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv) {
    fn = &amp;func;
    (*fn)(<span class="dv">10</span>);
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre>
<p>参数和返回值类型共同决定函数指针的类型，不同类型的函数指针之间不能做类型转换。</p>
<h2 id="函数指针数组">函数指针数组</h2>
<h3 id="指针数组">指针数组</h3>
<pre><code>int *p[10];</code></pre>
<p>在这条C语言语句中，由于<code>[]</code>运算符的优先级高于<code>*</code>运算符，因此p是一个有10个元素的数组，再结合<code>*</code>，可知数组p中的每一个元素的类型都是int型指针。上述声明等价于：</p>
<pre><code>int *(p[10]);</code></pre>
<h3 id="数组指针">数组指针</h3>
<pre><code>int (*p)[10];</code></pre>
<p>在这条C语言语句中，首先，p是一个指针，接着，p是一个指向数组的指针，并且数组中每一个元素的类型都是int。</p>
<h3 id="函数指针数组-1">函数指针数组</h3>
<p>函数指针数组的定义同普通指针数组的定义相同。</p>
<pre><code>int (*fn[10])(args);</code></pre>
<p>这样就定义了一个有10个元素的指针数组，其中，每个指针都是一个函数指针，指向一个返回值类型为 int，参数为 args 的函数。</p>
<h2 id="返回指针的函数">返回指针的函数</h2>
<p>C语言中，可以将函数的返回值类型定义为指针，具体做法例如：</p>
<pre><code>int * (*fn)(args);</code></pre>
<p>这样便定义了一个返回值类型为int型指针，参数为args的函数指针。</p>
<h2 id="返回数组指针的函数">返回数组指针的函数</h2>
<p>C语言中，函数的返回值类型可以是指向数组的指针。例如：</p>
<pre><code>int (*fn(args))[];
int (*fu(args))[] {
   
}</code></pre>
<p>这样，<code>fn</code>便是一个返回数组指针的函数，该数组指针指向一个有5个int型元素的数组。</p>
<h2 id="复杂指针嵌套语句的解读">复杂指针嵌套语句的解读</h2>
<p>C语言中所有复杂的指针声明都是由各种声明嵌套构成的。<strong>左右法则</strong>是一个从C标准中归纳出来的解读复杂指针声明的方法。</p>
<blockquote>
<p>左右法则：首先从最里面的未定义标识符开始，然后往右看，再往左看。每当遇到圆括号时，就掉转阅读方向。一旦解析玩圆括号里面所有的内容，就跳出圆括号。重复这一过程直至整个声明解析完毕。</p>
</blockquote>
<p>举例：</p>
<pre><code>int (*(*func)(int *p))[5];</code></pre>
<p>首先，func是一个函数指针，指向一个参数为<code>int *p</code>的函数，函数的返回值类型为指向数组的指针，该数组具有5个int型的元素。</p>
<p>再如下例：</p>
<pre><code>int (*(*fn)(args))[5];</code></pre>
<p>这便定义了一个函数指针，指向的函数返回一个数组指针，该数组指针指向一个有5个int类型的元素的数组。</p>
<h2 id="typedef与函数指针">typedef与函数指针</h2>
<p>在C语言中，typedef用作类型定义。建立一个类型别名的方法如下：</p>
<blockquote>
<p>在传统的变量声明表达式中用类型名替代变量名，然后把<code>typedef</code>关键字加在该语句的开头。</p>
</blockquote>
<p>例如：</p>
<pre><code>typedef int* (*A[5])(int, char **);
A a[5];</code></pre>
<p>与</p>
<pre><code>int* (*a[5])(int, char **);</code></pre>
<p>是等价的。</p>
<p>其他的更简单的使用typedef的语句如：</p>
<pre><code>typedef long long ll;
typedef char * pchar;</code></pre>
<p>也就容易理解了。</p>
<h2 id="函数指针作为参数">函数指针作为参数</h2>
<p>将函数指针类型作为参数进行传参时，函数名前加不加<code>&amp;</code>符号都可以。</p>
