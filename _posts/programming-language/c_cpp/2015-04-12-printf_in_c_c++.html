---
title: C/C++中的格式化IO
author: He Tao
date: 2015-04-12
tag: C/C++
category: 编程语言
layout: post
---

<p>C/C++中的格式化IO操作（输入、输出）使用非常灵活，但C/C++语言标准中复杂的关于格式化IO的定义也很让人头疼。接下来，将系统地讨论C/C++定义的格式化字符串，以及在使用格式化输出时容易出现错误的地方。</p>
<h2 id="格式化字符串的定义">格式化字符串的定义</h2>
<p>格式化参数以一个字符串的形式定义了输入/输出的格式，例如类型、宽度、进制，等等，标准格式化字符串的定义：</p>
<pre><code>%[flags][width][.precision][length]specifier</code></pre>
<!--more-->
<h2 id="科学计算法输出">科学计算法输出</h2>
<p><code>%e</code>和<code>%E</code>用于以科学计数法的格式来输出数字。<code>e</code>和<code>E</code>用来区分科学计数法输出中的字符<code>e</code>的大小写。</p>
<h2 id="输出">输出’%’</h2>
<p>在格式化输出中，不能直接输出<code>%</code>要使用<code>%%</code>来转义。</p>
<h2 id="输出指针值">输出指针值</h2>
<p>在C/C++中，指针占用四个字节，因此，可以使用<code>%d</code>来以输出<code>int</code>型整数的方式来输出指针。此外，格式化输出专门定义了输出指针变量的指定格式化字符标识<code>p</code>，可以通过<code>%p</code>的方式输出指针变量。</p>
<h2 id="n的含义"><code>%n</code>的含义</h2>
<p>在标准定义中，对于<code>%n</code>有如下阐述：</p>
<blockquote>
<p>Nothing printed. The corresponding argument must be a pointer to a signed int. The number of characters written so far is stored in the pointed location.</p>
</blockquote>
<p>也就是说，<code>%n</code>并不向<code>printf</code>函数传递输出内容相关的信息，而是要求<code>printf</code>函数把截止当前位置为止已经输出的<strong>字符</strong>总数写入相应变元(corresponding argument)指向的整形变量中。与<code>%n</code>相对应的变元必须是一个整形指针。</p>
<p>在格式化输入中，<code>%n</code>也有着类似的含义：</p>
<blockquote>
<p>No input is consumed. The number of characters read so far from stdin is stored in the pointed location.</p>
</blockquote>
<h2 id="gg的使用"><code>%g</code>/<code>%G</code>的使用</h2>
<p><code>%g</code>和<code>%G</code>的含义是总是输出<code>%f</code>/<code>%F</code>、<code>%e</code>/<code>%E</code>中较短的形式(shortest representation)。</p>
<h2 id="指定宽度">指定宽度</h2>
<p>对于每一组格式化输出，有两种方式来指定输出的宽度。</p>
<p>一种方式是在<code>%</code>和格式化字符（如<code>d</code>、<code>x</code>、<code>s</code>等等）之间用一个数字来指定宽度，这也是最常用的方式。例如：</p>
<pre><code>printf(&quot;%12d&quot;, 10);</code></pre>
<p>另一种方式是使用%*和一个与之对应的数字参数来指定宽度，如下例：</p>
<pre><code>printf(&quot;%*%d&quot;, 12, 10);</code></pre>
<p>则输出宽度为<code>12</code>。当然，也可以使用一个整型变量来指定这个宽度：</p>
<pre><code>int x = 12, y = 10;
printf(&quot;%*%d&quot;, x, y);</code></pre>
<p>同样，在输出浮点数，指定小数点后的位数是，也可以使用这种方式。</p>
<h2 id="对齐和填充">对齐和填充</h2>
<p>当指定的宽度大于要输出的宽度时，默认右对齐，并且以空白符填充。要想改变这种输出格式，可以在百分号<code>%</code>后，格式化字符前加一个<code>-</code>符号来使得输出左对齐。例如：</p>
<pre><code>printf(&quot;%-12d&quot;, 10);</code></pre>
<p>当输出右对齐是，可以指定字符<code>0</code>来填充前面的空白，如：</p>
<pre><code>printf(&quot;%05d&quot;, 10);</code></pre>
<p>得到的输出内容为：</p>
<pre><code>00010</code></pre>
<p>如下语句也能得到与之相同的输出：</p>
<pre><code>printf(&quot;%.5d&quot;, 10);</code></pre>
<p>输出结果为：</p>
<pre><code>00010</code></pre>
<h2 id="输出正负号-">输出正负号(+/-)</h2>
<p>在输出正数是，默认前面是没有一个加号<code>+</code>输出的，要想强制输出这个<code>+</code>符号，只需要在<code>%</code>后面加上一个<code>+</code>符号即可：</p>
<pre><code>printf(&quot;%+d&quot;, 20);</code></pre>
<p>输出内容为</p>
<pre><code>+20</code></pre>
<p>在MinGW g++ 4.8.1 的环境下测试是，使用这种方法输出<code>0</code>时，输出为：</p>
<pre><code>+0</code></pre>
<p>可见，格式化输入/输出时，<strong><code>+</code>和<code>-</code>之间有着很大的区别！</strong></p>
<h2 id="参考">参考</h2>
<p>参考内容：</p>
<ol style="list-style-type: decimal">
<li><a href="http://www.cplusplus.com/reference/cstdio/scanf/">cplusplus: scanf</a></li>
<li><a href="http://www.cplusplus.com/reference/cstdio/printf/">cplusplus: printf</a></li>
</ol>
